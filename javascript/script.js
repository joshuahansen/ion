function setDefault(){infoMenu.style.backgroundColor=defaultColor,alertsMenu.style.backgroundColor=defaultColor,configMenu.style.backgroundColor=defaultColor,adminMenu.style.backgroundColor=defaultColor,historyMenu.style.backgroundColor=defaultColor,networkMenu.style.backgroundColor=defaultColor,alarmMenu.style.backgroundColor=defaultColor,rebootMenu.style.backgroundColor=defaultColor,firmwareMenu.style.backgroundColor=defaultColor,systemtimeMenu.style.backgroundColor=defaultColor,snmpMenu.style.backgroundColor=defaultColor,clearInterval(dataInterval)}function setActive(e){setDefault(),e.style.backgroundColor=activeColor}function loadContent(e,t,n){var o=new XMLHttpRequest;o.onreadystatechange=function(){4==this.readyState&&200==this.status&&(document.getElementById("display").innerHTML=this.responseText,n&&n())},o.open("GET",e,!0),o.send(),setActive(document.getElementById(t)),0==t.localeCompare("config")&&setActive(document.getElementById("network")),0!=t.localeCompare("info")&&0!=t.localeCompare("alerts")&&0!=t.localeCompare("admin")&&0!=t.localeCompare("history")||closeConfig(),t.localeCompare("info")}function expandConfig(){document.getElementById("configSettings").style.display="block"}function closeConfig(){document.getElementById("configSettings").style.display="none"}function loadJSON(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==this.readyState&&200==this.status&&t(this.responseText)},n.open("GET",e,!0),n.send()}function sendJSON(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.send()}function loadSensors(){customDials(),dataInterval=setInterval(customDials,15e3)}function updateCurrentValues(){loadJSON("current",function(e){for(var t=JSON.parse(e),n=0;n<t.sensors.length;n++)0==t.sensors[n].type&&(document.getElementById("s"+t.sensors[n].port+"value").innerHTML=t.sensors[n].stringValue),document.getElementById("s"+t.sensors[n].port+"value").style.fontSize="45px",document.getElementById("port"+t.sensors[n].port).style.visibility="hidden",document.getElementById("s"+t.sensors[n].port+"type").innerHTML=sensorTypes[t.sensors[n].type],0!=t.sensors[n].name.localeCompare("")&&(document.getElementById("s"+t.sensors[n].port+"label").innerHTML=t.sensors[n].name)})}function customDials(){var e,t,n;loadJSON("current",function(o){for(var a=JSON.parse(o),s=0;s<a.sensors.length;s++){e=a.sensors[s].intValue,t=a.sensors[s].stringValue,n=a.sensors[s].port;var l="width";window.innerWidth<1e3&&(l="height");var d=0;switch(a.sensors[s].type){case 1:d=50;break;case 2:case 4:case 6:case 8:d=1;break;case 3:case 5:d=100;break;case 7:d=5}dials(e,t,"canvas"+n,d,l,a.sensors[s].type,a.sensors[s].threshMax),document.getElementById("s"+a.sensors[s].port+"type").innerHTML=sensorTypes[a.sensors[s].type],0!=a.sensors[s].name.localeCompare("")&&(document.getElementById("s"+a.sensors[s].port+"label").innerHTML=a.sensors[s].name)}}),console.log("=========================")}function dials(e,t,n,o,a,s,l){var d={canvasID:n,dataset:{value:e,displayValue:t,warningLevel:l,maxValue:o,type:s},bgcolor:"#222",color:"lightgreen",warningColor:"red",height:300,width:250};newDial(d)}function setThres(e){loadJSON("current",function(t){var n=JSON.parse(t);document.getElementById("portNum").value=e+1,0==n.sensors[e].type||(4==n.sensors[e].type?(document.getElementById("maxThreshold").max=1,document.getElementById("maxThreshMax").innerHTML="Closed",document.getElementById("maxThreshMin").innerHTML="Open",document.getElementById("portName").value=n.sensors[e].name,document.getElementById("maxValue").value=n.sensors[e].threshMax,document.getElementById("maxThreshold").value=n.sensors[e].threshMax,document.getElementById("minThreshRange").style.display="none",document.getElementById("setThresh").value=4,document.getElementById("sensorModal").style.display="block"):6==n.sensors[e].type?(document.getElementById("maxThreshold").max=1,document.getElementById("maxThreshMax").innerHTML="No Contact",document.getElementById("maxThreshMin").innerHTML="Contact",document.getElementById("portName").value=n.sensors[e].name,document.getElementById("maxValue").value=n.sensors[e].threshMax,document.getElementById("maxThreshold").value=n.sensors[e].threshMax,document.getElementById("minThreshRange").style.display="none",document.getElementById("setThresh").value=6,document.getElementById("sensorModal").style.display="block"):8==n.sensors[e].type?(document.getElementById("maxThreshold").max=1,document.getElementById("maxThreshMax").innerHTML="Leak",document.getElementById("maxThreshMin").innerHTML="No Leak",document.getElementById("portName").value=n.sensors[e].name,document.getElementById("maxValue").value=n.sensors[e].threshMax,document.getElementById("maxThreshold").value=n.sensors[e].threshMax,document.getElementById("minThreshRange").style.display="none",document.getElementById("setThresh").value=8,document.getElementById("sensorModal").style.display="block"):(document.getElementById("minThreshold").max=100,document.getElementById("minThreshMax").innerHTML=100,document.getElementById("maxThreshold").max=100,document.getElementById("maxThreshMax").innerHTML=100,document.getElementById("maxThreshMin").innerHTML=0,document.getElementById("portName").value=n.sensors[e].name,document.getElementById("minThreshold").value=n.sensors[e].threshMin,document.getElementById("minValue").value=n.sensors[e].threshMin,document.getElementById("maxValue").value=n.sensors[e].threshMax,document.getElementById("maxThreshold").value=n.sensors[e].threshMax,document.getElementById("setThresh").value=1,document.getElementById("minThreshRange").style.display="block",document.getElementById("sensorModal").style.display="block"))})}function updateThresh(){var e=document.getElementById("setThresh").value,t=document.getElementById("portName").value,n=document.getElementById("portNum").value;if(4==e||6==e||8==e)return sendJSON("/sensors/port"+n+"/?name="+t+"&maxThresh="+(o=document.getElementById("maxThreshold").value)),document.getElementById("sensorModal").style.display="none",!1;var o=document.getElementById("maxThreshold").value;return sendJSON("/sensors/port"+n+"/?name="+t+"&maxThresh="+o+"&minThresh="+document.getElementById("minThreshold").value),document.getElementById("sensorModal").style.display="none",!1}function showMinValue(e){document.getElementById("minValue").value=e}function changeMinRange(e){document.getElementById("minThreshold").value=e}function showMaxValue(e){document.getElementById("maxValue").value=e}function changeMaxRange(e){document.getElementById("maxThreshold").value=e}function closeModal(){document.getElementById("sensorModal").style.display="none"}function addRow(e,t,n){var o=document.getElementById("alertsTable").insertRow(n),a=o.insertCell(0),s=o.insertCell(1);a.appendChild(e),s.innerHTML=t}function loadAlerts(){loadJSON("current",function(e){for(var t=JSON.parse(e),n=1,o=0;o<t.sensors.length;o++)t.sensors[o].intValue>=t.sensors[o].threshMax?(addAlert("Port "+t.sensors[o].port,0,n),n++):t.sensors[o].intValue<=t.sensors[o].threshMin&&(addAlert("Port "+t.sensors[o].port,1,n),n++)})}function addAlert(e,t,n){var o=e+[" is above the Max Threshold"," is bellow the Min Threshold"][t],a=document.createElement("img");a.src="error.png",addRow(a,o,n)}function loadEmails(){loadJSON("emails",function(e){var t=JSON.parse(e);document.getElementById("email1").value=t[0].email,0==t[0].disable&&(document.getElementById("disableEmail1").checked="checked"),document.getElementById("email2").value=t[1].email,0==t[1].disable&&(document.getElementById("disableEmail2").checked="checked"),document.getElementById("email3").value=t[2].email,0==t[2].disable&&(document.getElementById("disableEmail3").checked="checked")})}function updateEmails(){var e=document.getElementById("email1").value,t=document.getElementById("disableEmail1").checked;t=1==t?0:1;var n=document.getElementById("email2").value,o=document.getElementById("disableEmail2").checked;o=1==o?0:1;var a=document.getElementById("email3").value,s=document.getElementById("disableEmail3").checked;return s=1==s?0:1,loadJSON("/emails/?email1="+e+"&disable1="+t+"&email2="+n+"&disable2="+o+"&email3="+a+"&disable3="+s),!1}function loadNetwork(){loadJSON("network",function(e){var t=JSON.parse(e);document.getElementById("ipInput").value=t.ip,document.getElementById("subnetInput").value=t.subnet,document.getElementById("gatewayInput").value=t.gateway,document.getElementById("pdnsInput").value=t.pdns,document.getElementById("sdnsInput").value=t.sdns})}function updateNetwork(){return sendJSON("/network?ip="+document.getElementById("ipInput").value+"&subnet="+document.getElementById("subnetInput").value+"&gateway="+document.getElementById("gatewayInput").value+"&pdns"+document.getElementById("pdnsInput").value+"&sdns="+document.getElementById("sdnsInput").value),!1}function reboot(){sendJSON("reboot?true")}function systemDate(){var e=new Date,t=formatDateTime(e.getDate())+"/"+formatDateTime(e.getMonth()+1)+"/"+formatDateTime(e.getFullYear());document.getElementById("systemDate").value=t}function systemTime(){var e=new Date,t=formatDateTime(e.getHours())+":"+formatDateTime(e.getMinutes())+":"+formatDateTime(e.getSeconds());document.getElementById("systemTime").value=t}function loadNTP(){loadJSON("ntp",function(e){var t=JSON.parse(e);document.getElementById("NTPServer").value=t.NTP,document.getElementById("timeZone").value="GMT"+t.timeZone,document.getElementById("daylightSavings").value=t.daylight})}function formatDateTime(e){return e<10&&(e="0"+e),e}function loadTime(){systemDate(),systemTime(),loadNTP(),dataInterval=setInterval(systemTime,1e3)}function updateDate(){for(var e,t=document.getElementsByName("systemTime"),n=0;n<t.length;++n)t[n].checked&&(e=t[n].value);if(0==e.localeCompare("ntp")){var o=document.getElementById("NTPServer").value,a=document.getElementById("timeZone").value,s=document.getElementById("daylightSavings").value;return a=0==a.localeCompare("GMT")?"0:00":a.replace("GMT",""),sendJSON("/systemTime?NTP="+o+"&timeZone="+a+"&daylight="+s),!1}if(0==e.localeCompare("sysTime"))return sendJSON("/systemTime?unix="+(d=(new Date).getTime())),!1;if(0==e.localeCompare("manual")){var l=new Date(document.getElementById("manualDate").value),d=(l.getDate(),l.getMonth(),l.getYear(),document.getElementById("manualTime").value,Date.parse("15 Aug, 2017 16:00:35")/1e3);return sendJSON("/systemTime?unix="+d),!1}}function upgradeFirmware(){}function loadSNMP(){loadJSON("snmp",function(e){var t=JSON.parse(e);document.getElementById("snInput").value=t.sysName,document.getElementById("scInput").value=t.sysContact,document.getElementById("slInput").value=t.sysLocation,document.getElementById("netagentport").value=t.netAgent,document.getElementById("trapport").value=t.trapPort,document.getElementById("snmpv3id").value=t.SNMPv3ID,document.getElementById("snmpv3input").value=t.SNMPv3})}function updateSNMP(){return sendJSON("/snmp?sysName="+document.getElementById("snInput").value+"&sysContact="+document.getElementById("scInput").value+"&sysLocation="+document.getElementById("slInput").value+"&netAgent"+document.getElementById("netagentport").value+"&trapPort="+document.getElementById("trapport").value+"&SNMPv3ID"+document.getElementById("snmpv3id").value+"&SNMPv3"+document.getElementById("snmpv3input").value),!1}function loadHistory(){var e=["green","blue","red","pink","black","orange","grey","yellow","aqua","maroon","violet","lime"],t=["tempHistory","smokeHistory","thHistory","doorHistory","vibrHistory","dryHistory","voltHistory"],n=["tempDiv","smokeDiv","thDiv","doorDiv","vibrDiv","dryDiv","voltDiv"],o=["15","30","45","60","75","90","105"],a=[],s=[],l=[],d=[],m=[],r=[],u=[],i=[a,s,l,d,m,r,u];loadJSON("sensorhistory",function(c){function y(e,t,n,o){if(0==t.length)console.log("hiding chart: "+n),document.getElementById(n).style.display="none";else{var a=document.getElementById(e);window.innerWidth>1e3?(a.width=window.innerWidth/3.3,a.height=window.innerHeight/2.8):(a.width=window.innerWidth/1.2,a.height=window.innerHeight/2);var s=document.getElementById(e).getContext("2d");new lineChart(a,s,{type:"line",data:{labels:o,datasets:t}})}console.log("Move to next chart")}function g(){for(var e=0;e<7;e++)console.log("Draw charts"),y(t[e],i[e],n[e],o)}for(var h=JSON.parse(c),I=0;I<h.length;I++){var p=h[I].type,v={label:"Port "+h[I].port,data:h[I].data,borderColor:e[I],fill:!1};switch(p){case 1:a.push(v);break;case 2:s.push(v);break;case 3:l.push(v);break;case 4:d.push(v);break;case 5:m.push(v);break;case 6:r.push(v);break;case 7:u.push(v)}}window.addEventListener("resize",g,!1),g()})}function updatePass(){var e=document.getElementById("currentPassInput").value,t=document.getElementById("newPassInput").value,n=document.getElementById("confirmPassInput").value;e.length<4||t.length<4||n.length<4?(console.log("ERROR"),document.getElementById("errormsg").innerHTML="Passwords must be at least 4 characters long"):0!=t.localeCompare(n)?(console.log("PASS DONT MATCH"),document.getElementById("errormsg").innerHTML="Passwords do not match"):loadJSON("/admin?currentPass="+e+"&newPass="+t+"&confPass="+n)}var infoMenu=document.getElementById("info"),alertsMenu=document.getElementById("alerts"),configMenu=document.getElementById("config"),adminMenu=document.getElementById("admin"),historyMenu=document.getElementById("history"),networkMenu=document.getElementById("network"),alarmMenu=document.getElementById("alarm"),rebootMenu=document.getElementById("reboot"),firmwareMenu=document.getElementById("firmware"),systemtimeMenu=document.getElementById("systemtime"),snmpMenu=document.getElementById("snmp"),defaultColor="#0B304C",activeColor="#0D6BB1",dataInterval,sensorTypes=["N/A","Temperature","Smoke","Temperature and Humidity","Door Switch","Vibration","Dry Contact","Voltage","Leak Rope"];window.onclick=function(e){e.target==document.getElementById("sensorModal")&&(document.getElementById("sensorModal").style.display="none")};